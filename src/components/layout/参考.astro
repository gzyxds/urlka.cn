---
/**
 * Header组件
 * 网站的顶部导航栏组件，提供网站的主要导航功能
 * 包含以下功能：
 * 1. 网站Logo和品牌名称
 * 2. 主导航菜单（首页、产品中心等）
 * 3. 下拉菜单（产品、文档、支持等）
 * 4. 移动端响应式菜单
 * 5. 暗黑模式切换按钮
 * 6. 用户操作按钮（登录、注册等）
 */

/**
 * 定义所有页面的导航链接
 * 用于构建主导航菜单
 */
const allPages = [
  { text: "常见问题", url: "/faqs" },
  { text: "更新日志", url: "/changelog" },
  { text: "集成", url: "/integrations" },
];

/**
 * 导入网站Logo
 * 用于在导航栏中显示网站标识
 */
import astroLogo from '../assets/logo.svg';

/**
 * 产品菜单项
 * 定义产品下拉菜单中的项目
 * 每个项目包含名称、URL、图标、描述和颜色
 */
const products = [
  { name: "数字分身", url: "/human", icon: "👤", desc: "智能数字人解决方案", color: "blue" },
  { name: "全能知识库", url: "/ai", icon: "🧠", desc: "企业级全能AI平台", color: "green" },
  { name: "聊天绘画", url: "/chat", icon: "💬", desc: "智能对话与创作", color: "purple" },
  { name: "论文创作", url: "/paper", icon: "📝", desc: "智能论文写作助手", color: "orange" },
  { name: "产品中心", url: "/shop", icon: "🎯", desc: "全部产品导航", color: "pink" },
  { name: "产品演示", url: "/demo", icon: "🖥️", desc: "在线体验中心", color: "orange" },
  { name: "AI提示词", url: "/tips", icon: "💡", desc: "AI提示词大全", color: "orange" },
  { name: "授权中心", url: "http://auth.cnai.art", icon: "👤", desc: "授权管理与使用", color: "orange", target: "_blank" },
];

/**
 * 支持菜单项
 * 定义支持下拉菜单中的项目
 * 每个项目包含名称、URL、图标、描述和颜色
 */
const supportItems = [
  { name: "更新日志", url: "/changelog", icon: "🛠️", desc: "获取最新更新", color: "teal" },
  { name: "联系我们", url: "/contact", icon: "📞", desc: "获取专业支持服务", color: "indigo" },
  { name: "集成与API", url: "/integrations", icon: "🔌", desc: "连接您喜爱的工具", color: "blue" },
  { name: "合作伙伴", url: "/cooperate", icon: "🤝", desc: "查看合作机会", color: "yellow" },
  { name: "渠道合作", url: "/channel", icon: "🤝", desc: "渠道合作与加盟", color: "yellow" },
  { name: "APP下载", url: "/app", icon: "📱", desc: "多终端APP下载", color: "green" },
];

/**
 * 文档菜单项
 * 定义文档下拉菜单中的项目
 * 每个项目包含名称、URL、图标、描述和颜色
 */
const docItems = [
  { name: "项目文档", url: "https://doc.artaigc.cn/", icon: "📄", desc: "5分钟快速上手", color: "red", target: "_blank" },
  { name: "飞书文档", url: "https://rwm01l8tn3x.feishu.cn/wiki/VqNCwBO0KiqWIWkSfdHcDigGnZg?from=from_copylink", icon: "🔍", desc: "详细功能说明", color: "blue" },
  { name: "数字分身", url: "https://doc.artaigc.cn/human/", icon: "👤", desc: "数字人部署文档", color: "green" },
  { name: "全能知识库", url: "https://doc.artaigc.cn/work/deployment/demo.html", icon: "🧠", desc: "企业知识库数文档", color: "purple" },
  { name: "聊天绘画", url: "https://doc.artaigc.cn/chat/", icon: "🎨", desc: "聊天绘画企业知识库数文档", color: "yellow" },
  { name: "论文创作", url: "https://doc.artaigc.cn/Paper/deployment/bt.html", icon: "📝", desc: "论文创作文档", color: "yellow" },
];

const faqItems = [
  { name: "使用指南", url: "/faqs/guide", icon: "📖", desc: "产品使用教程", color: "blue" },
  { name: "支付问题", url: "/faqs/payment", icon: "💳", desc: "支付方式与发票", color: "green" },
  { name: "技术支持", url: "/faqs/support", icon: "🛠️", desc: "技术支持服务", color: "purple" },
  { name: "API问题", url: "/faqs/api", icon: "🔌", desc: "接口使用问题", color: "orange" },
  { name: "账号问题", url: "/faqs/account", icon: "👤", desc: "账号管理指南", color: "red" }
];
---

<header class="sticky top-0 z-50 w-full bg-white/50 dark:bg-gray-900/50 backdrop-blur-md transition-all duration-300">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/" class="flex items-center space-x-2">
          <img src={astroLogo.src} alt="艺创AI Logo" class="h-8 w-8" />
          <span class="text-xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent">
            艺创AI
          </span>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden xl:flex xl:items-center xl:space-x-8">
        <a href="/" class="nav-link">首页</a>
        
        <!-- Products Dropdown -->
        <div class="relative group">
          <button class="nav-link flex items-center">
            产品中心
            <svg class="ml-1 h-4 w-4 transition-transform duration-200 group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="absolute left-0 mt-2 w-[500px] rounded-xl bg-white/50 dark:bg-gray-800/50 backdrop-blur-md shadow-xl ring-1 ring-black/5 dark:ring-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="p-4">
              <div class="grid grid-cols-2 gap-3">
                {products.map((product) => (
                  <a href={product.url} class="menu-item group/item">
                    <div class="flex items-center space-x-3 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-700/50 transition-all duration-200">
                      <span class={`flex h-10 w-10 items-center justify-center rounded-xl bg-${product.color}-100 dark:bg-${product.color}-900/30 text-${product.color}-600 dark:text-${product.color}-400 group-hover/item:scale-110 transition-transform duration-300`}>
                        {product.icon}
                      </span>
                      <div class="flex-1 min-w-0">
                        <div class="font-medium text-gray-900 dark:text-gray-100 group-hover/item:text-primary-600 dark:group-hover/item:text-primary-400 transition-colors duration-200">
                          {product.name}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 truncate">
                          {product.desc}
                        </div>
                      </div>
                      <svg class="h-5 w-5 text-gray-400 dark:text-gray-500 opacity-0 group-hover/item:opacity-100 transition-all duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                      </svg>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>

        <!--产品文档  -->
        <div class="relative group">
          <button class="nav-link flex items-center">
            产品文档
            <svg class="ml-1 h-4 w-4 transition-transform duration-200 group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="absolute left-0 mt-2 w-[500px] rounded-xl bg-white/50 dark:bg-gray-800/50 backdrop-blur-md shadow-xl ring-1 ring-black/5 dark:ring-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="p-4">
              <div class="grid grid-cols-2 gap-3">
                {docItems.map((item) => (
                  <a href={item.url} target={item.target} class="menu-item group/item">
                    <div class="flex items-center space-x-3 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-700/50 transition-all duration-200">
                      <span class={`flex h-10 w-10 items-center justify-center rounded-xl bg-${item.color}-100 dark:bg-${item.color}-900/30 text-${item.color}-600 dark:text-${item.color}-400 group-hover/item:scale-110 transition-transform duration-300`}>
                        {item.icon}
                      </span>
                      <div class="flex-1 min-w-0">
                        <div class="font-medium text-gray-900 dark:text-gray-100 group-hover/item:text-primary-600 dark:group-hover/item:text-primary-400 transition-colors duration-200">
                          {item.name}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 truncate">
                          {item.desc}
                        </div>
                      </div>
                      <svg class="h-5 w-5 text-gray-400 dark:text-gray-500 opacity-0 group-hover/item:opacity-100 transition-all duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                      </svg>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>

        <a href="/pricing" class="nav-link">产品价格</a>
        <a href="/company" class="nav-link">关于我们</a>
        <a href="/contact" class="nav-link">联系我们</a>

        <!-- Support Dropdown -->
        <div class="relative group">
          <button class="nav-link flex items-center">
            支持与服务
            <svg class="ml-1 h-4 w-4 transition-transform duration-200 group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="absolute left-0 mt-2 w-[500px] rounded-xl bg-white/50 dark:bg-gray-800/50 backdrop-blur-md shadow-xl ring-1 ring-black/5 dark:ring-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="p-4">
              <div class="grid grid-cols-2 gap-3">
                {supportItems.map((item) => (
                  <a href={item.url} class="menu-item group/item">
                    <div class="flex items-center space-x-3 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-700/50 transition-all duration-200">
                      <span class={`flex h-10 w-10 items-center justify-center rounded-xl bg-${item.color}-100 dark:bg-${item.color}-900/30 text-${item.color}-600 dark:text-${item.color}-400 group-hover/item:scale-110 transition-transform duration-300`}>
                        {item.icon}
                      </span>
                      <div class="flex-1 min-w-0">
                        <div class="font-medium text-gray-900 dark:text-gray-100 group-hover/item:text-primary-600 dark:group-hover/item:text-primary-400 transition-colors duration-200">
                          {item.name}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 truncate">
                          {item.desc}
                        </div>
                      </div>
                      <svg class="h-5 w-5 text-gray-400 dark:text-gray-500 opacity-0 group-hover/item:opacity-100 transition-all duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                      </svg>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>
        <a href="/blog" class="nav-link">最新动态</a>
      </nav>

      <!-- Right Side Actions -->
      <div class="flex items-center space-x-4">
        <!-- Dark Mode Toggle -->
        <button 
          x-on:click="darkMode = !darkMode"
          class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200"
          aria-label="切换暗黑模式"
        >
          <svg x-show="!darkMode" class="h-5 w-5 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
          <svg x-show="darkMode" class="h-5 w-5 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        </button>

        <!-- Auth Buttons -->
        <div class="flex flex-wrap justify-center xl:justify-start gap-4">
          <a 
            href="https://auth.cnai.art/regist.htm"
            target="_blank"
            rel="noopener noreferrer"
            class="group hidden sm:inline-flex items-center px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all"
          >
            <span>立即购买</span>
          </a>
          
          <a 
            href="https://auth.cnai.art/regist.htm"
            target="_blank"
            rel="noopener noreferrer"
            class="group hidden sm:inline-flex items-center px-6 py-2.5 bg-white dark:bg-gray-800 text-gray-800 dark:text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all"
          >
            <span>登入/注册</span>
          </a>
        </div>
        
        <!-- Mobile Menu Button -->
        <button 
          x-data="{open: false}"
          x-on:click="open = !open; $dispatch('toggle-mobile-menu', {open})"
          class="xl:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200"
          aria-label="切换菜单"
        >
          <svg x-bind:class="{'hidden': open, 'block': !open}" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg x-bind:class="{'block': open, 'hidden': !open}" class="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div 
    x-data="{ open: false }"
    x-on:toggle-mobile-menu.window="open = $event.detail.open"
    x-show="open"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 -translate-y-4"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 -translate-y-4"
    class="xl:hidden fixed inset-x-0 top-16 z-50 w-full overflow-hidden bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800"
    x-cloak
  >
    <nav class="relative max-h-[calc(100vh-4rem)] overflow-y-auto p-4 space-y-4">
      <div class="space-y-4">
        <a href="/" class="mobile-nav-item">首页</a>
        
        <!-- Mobile Products Menu -->
        <div x-data="{expanded: false}" class="space-y-2">
          <button 
            x-on:click="expanded = !expanded"
            class="mobile-nav-item w-full flex items-center justify-between group"
          >
            <span x-bind:class="{'text-primary-600 dark:text-primary-400': expanded}">产品中心</span>
            <svg 
              x-bind:class="{'rotate-180 text-primary-600 dark:text-primary-400': expanded}"
              class="h-5 w-5 transition-all duration-200 group-hover:text-primary-600 dark:group-hover:text-primary-400" 
              fill="none" viewBox="0 0 24 24" stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div x-show="expanded" x-collapse x-cloak>
            <div class="pt-2 pl-4 border-l-2 border-primary-100 dark:border-primary-900">
              <div class="grid grid-cols-2 gap-2">
                {products.map(product => (
                  <a href={product.url} class="mobile-menu-item">
                    <div class="flex flex-col">
                      <div class="flex items-center space-x-2">
                        <span class={`text-${product.color}-600 dark:text-${product.color}-400`}>{product.icon}</span>
                        <span class={`font-medium text-${product.color}-600 dark:text-${product.color}-400`}>{product.name}</span>
                      </div>
                      <span class="text-xs text-gray-500 mt-1">{product.desc}</span>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>

        <!-- Mobile Documentation Menu -->
        <div x-data="{expanded: false}" class="space-y-2">
          <button 
            x-on:click="expanded = !expanded"
            class="mobile-nav-item w-full flex items-center justify-between group"
          >
            <span x-bind:class="{'text-primary-600 dark:text-primary-400': expanded}">产品文档</span>
            <svg 
              x-bind:class="{'rotate-180 text-primary-600 dark:text-primary-400': expanded}"
              class="h-5 w-5 transition-all duration-200 group-hover:text-primary-600 dark:group-hover:text-primary-400" 
              fill="none" viewBox="0 0 24 24" stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div x-show="expanded" x-collapse x-cloak>
            <div class="pt-2 pl-4 border-l-2 border-primary-100 dark:border-primary-900">
              <div class="grid grid-cols-2 gap-2">
                {docItems.map(item => (
                  <a href={item.url} target={item.target} class="mobile-menu-item">
                    <div class="flex flex-col">
                      <div class="flex items-center space-x-2">
                        <span class={`text-${item.color}-600 dark:text-${item.color}-400`}>{item.icon}</span>
                        <span class={`font-medium text-${item.color}-600 dark:text-${item.color}-400`}>{item.name}</span>
                      </div>
                      <span class="text-xs text-gray-500 mt-1">{item.desc}</span>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>

        <a href="/pricing" class="mobile-nav-item">产品价格</a>
        <a href="/company" class="mobile-nav-item">关于我们</a>
        <a href="/contact" class="mobile-nav-item">联系我们</a>

        <!-- Mobile Support Menu -->
        <div x-data="{expanded: false}" class="space-y-2">
          <button 
            x-on:click="expanded = !expanded"
            class="mobile-nav-item w-full flex items-center justify-between group"
          >
            <span x-bind:class="{'text-primary-600 dark:text-primary-400': expanded}">支持与服务</span>
            <svg 
              x-bind:class="{'rotate-180 text-primary-600 dark:text-primary-400': expanded}"
              class="h-5 w-5 transition-all duration-200 group-hover:text-primary-600 dark:group-hover:text-primary-400" 
              fill="none" viewBox="0 0 24 24" stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div x-show="expanded" x-collapse x-cloak>
            <div class="pt-2 pl-4 border-l-2 border-primary-100 dark:border-primary-900">
              <div class="grid grid-cols-2 gap-2">
                {supportItems.map(item => (
                  <a href={item.url} class="mobile-menu-item">
                    <div class="flex flex-col">
                      <div class="flex items-center space-x-2">
                        <span class={`text-${item.color}-600 dark:text-${item.color}-400`}>{item.icon}</span>
                        <span class={`font-medium text-${item.color}-600 dark:text-${item.color}-400`}>{item.name}</span>
                      </div>
                      <span class="text-xs text-gray-500 mt-1">{item.desc}</span>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>
        <a href="/blog" class="mobile-nav-item">最新动态</a>
      </div>

      <!-- Mobile Auth Buttons -->
      <div class="pt-6 space-y-4">
        <a 
          href="https://auth.cnai.art/regist.htm" 
          class="block w-full text-center px-4 py-3 rounded-xl bg-primary-600 hover:bg-primary-700 text-white font-medium transition-colors duration-200"
        >
          会员中心
        </a>
        <a 
          href="https://auth.cnai.art/regist.htm" 
          class="block w-full text-center px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 font-medium transition-colors duration-200"
        >
          登录/注册
        </a>
      </div>
    </nav>
  </div>
</header>

<style>
  .nav-link {
    @apply px-2 xl:px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 font-medium transition-all duration-300 relative overflow-hidden;
  }

  .nav-link::after {
    content: '';
    @apply absolute bottom-0 left-0 w-full h-0.5 bg-primary-600 dark:bg-primary-400 transform scale-x-0 transition-transform duration-300 origin-left;
  }

  .nav-link:hover::after {
    @apply scale-x-100;
  }

  .menu-item {
    @apply flex items-center space-x-2 xl:space-x-3 p-2 rounded-xl transition-all duration-300 hover:bg-blue-50 dark:hover:bg-blue-800/50;
  }

  .mobile-nav-item {
    @apply flex items-center justify-between w-full px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300 font-medium hover:translate-x-1;
  }

  .mobile-menu-item {
    @apply flex items-center w-full px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300 hover:translate-x-1;
  }

  [x-cloak] { 
    display: none !important; 
  }
</style>

<script is:inline>
  // 使用防抖函数优化滚动事件处理
  function debounce(func, wait) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  // 初始化变量
  let header;
  let lastScrollY = window.scrollY;
  let ticking = false;

  // 滚动处理函数
  function handleScroll() {
    if (!header) header = document.querySelector('header');
    if (!header) return;
    
    const currentScrollY = window.scrollY;
    
    if (!ticking) {
      window.requestAnimationFrame(() => {
        if (currentScrollY > 20) {
          header.classList.add('shadow-md');
        } else {
          header.classList.remove('shadow-md');
        }
        
        lastScrollY = currentScrollY;
        ticking = false;
      });
      
      ticking = true;
    }
  }

  // 使用防抖优化滚动事件
  const debouncedScroll = debounce(handleScroll, 10);
  
  // 添加滚动事件监听
  window.addEventListener('scroll', debouncedScroll, { passive: true });
  
  // DOM加载完成后初始化
  document.addEventListener('DOMContentLoaded', () => {
    header = document.querySelector('header');
    handleScroll();
  });
  
  // 初始检查滚动位置
  handleScroll();
</script>